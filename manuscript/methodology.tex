\section{Methodology}
\label{sec:methodology}

\subsection{Fundamentals of magnetic equivalent layer and the positive magnetic-moment distribution}
\label{subsec:mag_eqlayer}

%%% Continuous layer
Considering a Cartesian coordinate system with $x$-, $y$- and $z$-axis being oriented to north, east and downward, respectively. Let $\Delta T_i \equiv \Delta T (x_i,y_i,z_i)$ be the total-field anomaly, at the $i$th position $(x_i,y_i,z_i)$, produced by a continuos layer located below the observation plane at a depth equal to $z_c$, where $z_c > z_i$, and $p(x',y',z_c)$ is the distribution of magnetic dipoles per unit area over the layer. The total-field anomaly produced by this continuous layer is given by 

\begin{equation}
\Delta T_i = \int \limits_{-\infty}^{+\infty } \int \limits_{-\infty}^{+\infty }  p(x',y',z_c)  [\gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}(x_i,y_i,z_i,x',y',z_c) \,\hat{\mathbf{m}}(\mathbf{q})] dx' \,dy',
\label{eq:continuous_layer}
\end{equation}
where $\gamma_m$ is a constant proportional to the vacuum permeability, $\hat{\mathbf{F}}_0$ is a unit vector with the same direction of the main geomagnetic field given by

\begin{equation}
	\hat{\mathbf{F}}_0 =
	\left[ \begin{array}{c}
		 \cos I \cos D \\
		 \cos I \sin D \\
		 \sin I     
	\end{array} \right] ,
	\label{eq:main_field}
\end{equation}
where $I$ and $D$ are, respectively, the inclination and declination and $\mathbf{M}(x_i,y_i,z_i,x',y',z_c)$ is a $3 \times 3$ dimensional matrix (PAPER LADY DAI) equal to  
\begin{equation}
\mathbf{M}(x_i,y_i,z_i,x',y',z_c) =
\left[ \begin{array}{ccc}
\partial_{xx} \phi & \partial_{xy} \phi &\partial_{xz} \phi \\  \partial_{yx} \phi & \partial_{yy} \phi &\partial_{yz} \phi \\  \partial_{zx} \phi &\partial_{zy}\phi  & \partial_{zz} \phi    
\end{array} \right] ,
\label{eq:H}
\end{equation}
where $\partial_{\alpha \beta} \phi$, $\alpha = x, y, z$ and $\beta = x, y, z$, is the second derivative of the scalar function 

\begin{equation}
\phi (x_i,y_i,z_i,x',y',z_c) = \frac{1}{[(x_i-x')^2 + (y_i-y')^2 + (z_i-z_c)^2]^{\frac{1}{2}}} .
\label{eq:phi}
\end{equation}
with respect to the Cartesian coordinates $x_i$, $y_i$ and $z_i$ of the observation points. The $\hat{\mathbf{m}}(\mathbf{q})$ is a unit vector with the magnetization direction of the dipoles over layer given by 

\begin{equation}
	\hat{\mathbf{m}}(\mathbf{q}) =
	\left[ \begin{array}{c}
		\cos \tilde{\i} \cos \tilde{d} \\
		\cos \tilde{\i} \sin \tilde{d}\\
		\sin \tilde{\i}
	\end{array} \right] 
	\label{eq:mag_vec}
\end{equation}
and $\mathbf{q}$ is a $2 \times 1$ vector with components given by 

\begin{equation}
	\mathbf{q} =
	\left[ \begin{array}{c}
		\tilde{\i} \\ 
		\tilde{d} 
	\end{array} \right] ,
	\label{eq:q_vector}
\end{equation}
where $\tilde{\i} $ and $\tilde{d} $ are the inclination and declination of the magnetization direction of the dipoles on the layer, respectively. We can also notice that the vector defined in equation \ref{eq:mag_vec} has a single and uniform magnetization direction of all dipoles on the layer. For convenience, this unit vector can be rewritten as follows

%% Explaining the positive property on magnetic layer
\begin{equation}
\hat{\mathbf{m}}(\mathbf{q}) = \mathbf{R}\hat{\mathbf{h}} \: ,
\label{eq:h-rotation-matrix}
\end{equation}
where $\hat{\mathbf{h}}$ defines the uniform magnetization direction of an abitrary magnetic source and $\mathbf{R}$ is a $3 \times 3$ matrix obtained from Euler's rotation theorem. This theorem states that any rotation can be parametrized by using three parameters called Euler angles (CITAR GOLDSTEIN). That is, if all dipoles that set up the equivalent layer have the same magnetization direction $\hat{\mathbf{m}}(\mathbf{q})$ and this direction is the same as the true magnetic source $\hat{\mathbf{h}}$, then the matrix $\mathbf{R}$ (equation \ref{eq:h-rotation-matrix}) is equal to identity. For this reason, the total-field anomaly produced by equivalent layer at the $i$th position $(x_i,y_i,z_i)$ (equation \ref{eq:continuous_layer}) can be rewritten as 

\begin{equation}
\Delta T_i = \int \limits_{-\infty}^{+\infty } \int \limits_{-\infty}^{+\infty }  p(x',y',z_c)  [\gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}(x_i,y_i,z_i,x',y',z_c) \,\hat{\mathbf{h}}] dx' \,dy',
\label{eq:continuous_layer_source}
\end{equation} 
which represents the total-field anomaly produced by continuous layer with the same direction of the arbitrary magnetic source. Thus, the RTP field $\Delta T_{i}^{PL}$ produced by equivalent layer at the point $(x_i,y_i,z_i)$ is equal to 

\begin{equation}
\Delta T_{i}^{PL} = \int \limits_{-\infty}^{+\infty } \int \limits_{-\infty}^{+\infty }  p(x',y',z_c)  [\gamma_m \partial_{zz} \phi(x_i,y_i,z_i,x',y',z_c) ] dx' \,dy',
\label{eq:continuous_layer_pole}
\end{equation}
where $\partial_{zz} \phi(x_i,y_i,z_i,x',y',z_c)$ is the second derivative of the inverse of distance (equation \ref{eq:phi}) with respect of $z_i$, evaluated at the point $(x_i,y_i,z_i)$. However, by considering the RTP field $\Delta T_{i}^{PS}$ produced by an arbitrary uniformly magnetized source, we have

\begin{equation}
\Delta T_{i}^{PS} = \gamma_m \partial_{zz} \Gamma(x_i,y_i,z_i) \, m,
\label{eq:source_pole}
\end{equation}
which represents the total-field anomaly produced at the pole, where $m$ is the magnetization intensity of the magnetic source. The $\partial_{zz} \Gamma(x_i,y_i,z_i)$ is the second derivative in relation to $z_i$ of a scalar function $\Gamma(x_i,y_i,z_i)$ that depends on source geometry and the observation point $(x_i,y_i,z_i)$. From equation \ref{eq:continuous_layer_pole} and \ref{eq:source_pole}, we obtain 
 
\begin{equation}
m \, \partial_{zz} \Gamma(x_i,y_i,z_i) = \int \limits_{-\infty}^{+\infty } \int \limits_{-\infty}^{+\infty }  p(x',y',z_c)  \partial_{zz} \phi(x_i,y_i,z_i,x',y',z_c)  dx' \,dy'.
\label{eq:source_layer_pole}
\end{equation}
We can notice that equation \ref{eq:source_layer_pole} can be calculated differentiating the following equation

\begin{equation}
m \, \partial_{z} \Gamma(x_i,y_i,z_i) = \int \limits_{-\infty}^{+\infty } \int \limits_{-\infty}^{+\infty }  \dfrac{p(x',y',z_c) (z_c - z_i)}{[(x_i-x')^2 + (y_i-y')^2 + (z_i-z_c)^2]^{\frac{3}{2}}}    dx' \,dy',
\label{eq:mag_upward}
\end{equation}
where $z_c > z_i$, with respect to the vertical component $z_i$. From potential-field theory, we can highlight the classical upward continuation integral 

\begin{equation}
U(x_i,y_i,z_i) = \dfrac{(z_c-z_i)}{2\pi} \int \limits_{-\infty}^{+\infty } \int \limits_{-\infty}^{+\infty }  \dfrac{U(x',y',z_c) }{[(x_i-x')^2 + (y_i-y')^2 + (z_i-z_c)^2]^{\frac{3}{2}}}    dx' \,dy',
\label{eq:upward_continuation_integral}
\end{equation}
where the function $U(x_i,y_i,z_i)$ is an hamornic function at all $(x_i,y_i,z_i)$ (CITAR BLAKELY). In this case, this function represents the total-field anomaly at the point $(x_i,y_i,z_i)$ which can be mathematically interpreted as the convolution between its values $U(x',y',z_c)$ and the vertical derivative in relation to $z_i$ of the equation \ref{eq:phi}, evaluated on the horizontal plane $z_i =z_c$. Therefore, according the classical upward continuation function (equation \ref{eq:upward_continuation_integral}), the magnetic-moment distribution $p(x',y',z_c)$ in equation \ref{eq:mag_upward} assumes the form 

\begin{equation}
p(x',y',z_c) = \dfrac{m}{2\pi} \, \partial_{z} \Gamma(x',y',z_c) ,
\label{eq:positivity_prop}
\end{equation}
where $\partial_{z} \Gamma(x',y',z_c)$ is the derivative of the scalar function $\partial_{z} \Gamma(x_i,y_i,z_i)$ in relation to $z_i$ evaluated over the equivalent layer. The most interesting aspect of equation \ref{eq:positivity_prop} is that the magnetic-moment distribution is defined as the product of a positive constant $\dfrac{m}{2\pi}$ and the function $\partial_{z} \Gamma(x',y',z_c)$, which is all positive at all points $(x',y',z_c)$ over the equivalent layer. This relation is simular to that presented by CITAR PEDERSEN (1991) and LI (2014). In the wavenumber domain, these authors determined the
magnetic-moment distribution within a continuous equivalent layer with the same magnetization direction as the local-geomagnetic field at the pole. They also considered a planar equivalent layer located below and parallel to a horizontal plane containing the observed total-field anomaly. They assume a magnetic source having a purely induced magnetization. Under these assumptions, CITAR PEDERSEN (1991) and LI (2014) concluded that the magnetic moment distribution within the continuous equivalent layer is proportional to the pseudogravity anomaly produced by the source on the plane of the equivalent layer. By following different approaches, CITAR BARATCHART (2013) and Lima (2016) pointed out that, by imposing a nonnegativity constraint, the solution to the inverse problem is a unique distribution for the magnetic equivalent sources. Here, we do not follow the same wavenumber-domain reasoning used by these authors.
Equation \ref{eq:positivity_prop}, however, generalizes this positivity condition because it (1) holds true for all cases in which the magnetization of the equivalent layer has the same direction as the true
magnetization of the sources, whenever it is purely induced or not, (2) does not require that the observed total-field anomaly data be on a plane and, (3) does not require a planar equivalent layer.

%% Discretizing layer
\subsection{Parametrization and forward problem}

In practical situations, its not possible to determine a continuous magnetic-moment distribution $p(x',y',z_c)$ over the layer as shown in equation \ref{eq:continuous_layer}. For this reason, the layer has to be approximated by a discrete set of dipoles with unit volume located at a constant depth $z = z_c$. By discretizing the integrand of equation \ref{eq:continuous_layer}, the predicted total-field anomaly at the point $(x_i,y_i,z_i)$ is given by 

\begin{equation}
\Delta T_i = f_i(\mathbf{s}) ,
\label{eq:tfa_pred_i}
\end{equation}    
where $\Delta T_i$ is the $i$th element of the $N$-dimensional predicted data vector $\mathbf{\Delta T}(\mathbf{s})$. The function $f_i$ maps the parameter onto the data, in which parameter vector $\mathbf{s}$ is formed by an $M$-dimensional vector $\mathbf{p}$ vector whose $j$th element $p_j$ is the magnetic moment of the $j$th dipole with magnetization direction $\mathbf{q}$ (equation \ref{eq:q_vector}) to all dipoles. Explicitly, the function $f_i$ is described as 

\begin{equation}
f_i (\mathbf{s}) = \sum_{j=1}^{M} p_j g_{ij} (\mathbf{q}) = \mathbf{p}^T \mathbf{g}_i(\mathbf{q})
\label{eq:f_i}
\end{equation}
where

\begin{equation}
g_{ij} (\mathbf{q})  = \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij} \hat{\mathbf{m}}(\mathbf{q})
\label{eq:g_ij}
\end{equation}
is an harmonic function representing the total-field anomaly produced at the $i$th position $(x_i,y_i,z_i)$ by a dipole located at $(x_j,y_j,z_c)$ with unitary magnetic-moment intensity. The matrix $\mathbf{M}_{ij}$ is formed by the second derivatives of a function $\phi_{ij}$ that depends on the inverse of the scalar function $r_{ij} = [(x_i-x_j)^2 + (y_i-y_j)^2 + (z_i-z_c)^2]^{1/2}$, analogously to equation \ref{eq:H} and \ref{eq:phi}. From equation \ref{eq:tfa_pred_i}-\ref{eq:g_ij}, we can notice that the predicted total-field anomaly $\mathbf{\Delta T} (\mathbf{s})$ has a linear relation with the magnetic moment $\mathbf{p}$ and a nonlinear relation with the magnetizaion direction $\mathbf{q}$.    

\subsection{Inverse problem}

%%%% Defining the objective function
Let $\mathbf{\Delta T}^o$ be an \textit{N}-dimensional vector whose $i$th element $\Delta T_i^o$ is the total-field anomaly observation produced by a magnetic source at the point $(x_i,y_i,z_i)$, $i = 1, \ldots, N$. In order to estimate the magnetization direction, we have to formulate an inverse problem by imposing a positivity constraint on the magnetic-moment distribution. It can be performed minimizing the difference between the observed data $\mathbf{\Delta T}^o$ and the predicted data $\mathbf{\Delta T} (\mathbf{s})$ by solving the following constrained problem of

\begin{subequations}
\begin{align}
& \text{minimizing}
& &\Psi(\mathbf{s}) =\lVert \mathbf{\Delta T}^o - \mathbf{\Delta T} (\mathbf{s}) \rVert_{2}^{2} + \, \mu f_0 \parallel \mathbf{p} \parallel_{2}^{2} \\
& \text{subject to}
& & \mathbf{p} \geqslant 0
\end{align}
\label{eq:positivity_goal_function}
\end{subequations}
where in equation \ref{eq:positivity_goal_function}a the first term is the data misfit function, the second term of equation \ref{eq:positivity_goal_function}a is a zeroth-order Tikhonov regularization function, $\mu$ is the regularizing parameter, $\| \cdot \|_{2}^{2}$ represents the squared Euclidean norm and $f_0$ is a normalizing factor. In equation \ref{eq:positivity_goal_function}b, $\mathbf{0}$ is a null vector and the inequality sign is applied element by element. This inequality imposes positivity constraints on the estimated magnetic moments of all dipoles, which is solved by using the nonnegative least squares (NNLS) proposed by (CITAR LAWSON HANSON 1974). 

%% Deducing the equations
The process of minimizing the goal function shown in equation \ref{eq:positivity_goal_function}a starts with an initial approximation to the parameter vector $\mathbf{s}_0$ and then solving a sequence of linear problem of estimating a correction $\mathbf{\Delta s}$. The procedure is repeated until a minimum of goal function (equation \ref{eq:positivity_goal_function}a) is reached. This procedure is determined by using a gradient-based iterative optimization method like Gauss-Newton. Mathematically, the correction $\mathbf{\Delta s}$ is expressed as a second-order expansion of the goal function given by     

\begin{equation}
\Psi(\mathbf{s}_0 + \mathbf{\Delta s}) \approx \mathbf{J}(\mathbf{s}_0) + \mathbf{J}^T(\mathbf{s}_0)  \mathbf{\Delta s} + 
\frac{1}{2} \mathbf{\Delta s}^T \mathbf{H}(\mathbf{s}_0) \mathbf{\Delta s}
\label{eq:sec_ord_goal}
\end{equation}
in which $\mathbf{J}(\mathbf{s}_0)$ and $\mathbf{H}(\mathbf{s}_0)$ are, respectively, the gradient vector and the Hessian matrix of equation \ref{eq:positivity_goal_function}a. Thus, taking the gradient of the function \ref{eq:sec_ord_goal}, the parameter perturbation vector $\mathbf{\Delta s}^k$ at the $k$th iteration is obtained by solving the linear system

\begin{equation}
\mathbf{H}^k (\mathbf{s}_0) \mathbf{\Delta s}^k = - \mathbf{J}^k (\mathbf{s}_0).
\label{eq:linear_sys_GN}
\end{equation} 
However, looking in more detail at the equation \ref{eq:linear_sys_GN}, the linear system can be given by equation 

\begin{equation}
\left[
\begin{array}{c|c}
\mathbf{H}_{pp}^{k} & \mathbf{H}_{pq}^{k} \\
\hline
\mathbf{H}_{qp}^{k}& \mathbf{H}_{qq}^{k}
\end{array}
\right] \left[ \begin{array}{c}
\mathbf{\Delta p}^k \\ 
\mathbf{\Delta q}^k 
\end{array} \right] = -\left[ \begin{array}{c}
\mathbf{J}_{p}^{k} \\ 
\mathbf{J}_{q}^{k} 
\end{array} \right] ,
\label{eq:linear_sys_GN_block}
\end{equation}
in which $\mathbf{J}_{\alpha}^{k}$ and $\mathbf{H}_{\alpha \beta}^{k}$, where $\alpha = p,q$ and $\beta = p,q$, are the gradient vector and the Hessian matrix calculated in relation to each component of the magnetic-moment vector $\mathbf{p}$ and the magnetization direction vector $\mathbf{q}$, respectively. Besides, in order to simplify the linear system \ref{eq:linear_sys_GN_block}, we consider null cross-derivatives. As we shown earlier, the predicted total-field anomaly has a linear relation with magnetic moments $\mathbf{p}^k$.  For this reason, the gradient vector and the Gauss-Newton approximation of the goal function (equation \ref{eq:positivity_goal_function}a) relative to the part of magnetic moments are, respectively,

\begin{equation}
\mathbf{J}_{p}^{k} = -2 \mathbf{G}_{p}^{k^T} \mathbf{\Delta T}^o
\label{eq:grad_p}
\end{equation}   
and   

\begin{equation}
\mathbf{H}_{pp}^{k} = 2 \mathbf{G}_{p}^{k^T} \mathbf{G}_{p}^{k} + 2 \mu f_{0}^{k} \mathbf{I} 
\label{eq:hess_p}
\end{equation}
where $\mathbf{G}_p^{k}$ is the $N \times M$ sensitivity matrix at the $k$th iteration, whose elements are composed by the derivative of equation \ref{eq:positivity_goal_function}a in relation of $j$th element of the vector $\mathbf{p}^k$, $\mathbf{I}$ is an identity matrix and the normalizing factor $f_{0}^{k}$ is equal to

\begin{equation}
f_{0}^{k} = \dfrac{tr(\mathbf{G}_{p}^{k^T} \mathbf{G}_{p}^{k})}{M} \, ,
\label{eq:norm_factor}
\end{equation}
where $tr$ is denotaded as the trace of the matrix $\mathbf{G}_{p}^{k^T} \mathbf{G}_{p}^{k}$ and $M$ is the total number of dipoles composing the layer. Thus, at the $k$th iteration, we have to solve the linear system given by

\begin{equation}
\left[ \mathbf{G}_{p}^{k^T} \mathbf{G}_{p}^{k} + \mu f_{0}^{k} \mathbf{I} \right] \mathbf{p}^{k} = \mathbf{G}_{p}^{k^T} \mathbf{\Delta T}^o.
\label{eq:linear_sys_p}
\end{equation} 
Owing to nonlinear relation of the magnetization direction $\mathbf{q}^k$ with the predicted total-field anomaly, the gradient vector and the Hessian matrix for this case are, respectively,

\begin{equation}
\mathbf{J}_{q}^{k} = -2 \mathbf{G}_{q}^{k^T} [ \mathbf{\Delta T}^o -  \mathbf{\Delta T} (\mathbf{s}^k) ] 
\label{eq:grad_q}
\end{equation}   
and   

\begin{equation}
\mathbf{H}_{qq}^{k} = 2 \mathbf{G}_{q}^{k^T} \mathbf{G}_{q}^{k} 
\label{eq:hess_q}
\end{equation}
in which $\mathbf{G}_q^k$ is a $N \times 2$ sensitivity matrix, whose elements are composed by derivative of equation \ref{eq:positivity_goal_function} in relation of each component of the vector $\mathbf{q}^k$, that are the inclination and declination, respectively. Nevertheless, in order to calculate the correction $\mathbf{\Delta q}^k$ at the $k$th iteration, we use the Levernberg-Marquardt method (CITAR ASTER) by solving the linear system

\begin{equation}
\left[ \mathbf{G}_{q}^{k^T} \mathbf{G}_{q}^{k} + \lambda^k \mathbf{I} \right] \mathbf{\Delta q}^k = \mathbf{G}_{q}^{k^T}[ \mathbf{\Delta T}^o -  \mathbf{\Delta T} (\mathbf{s}^k) ],
\label{eq:linear_sys_q}
\end{equation}
where $\lambda$ is the Marquardt parameter that is updated along the iterative process and $\mathbf{I}$ is an indentity matrix.

\subsection{Iterative process for magnetization estimation}

The estimation of the magnetic moments $\mathbf{p}^{\sharp}$ and the magnetization direction $\mathbf{q}^{\sharp}$ is formulated as an inverse problem of minimizing the difference between the observed data $ \mathbf{\Delta T}^o $ and the predicted data $\mathbf{\Delta T} (\mathbf{s})$. As we can notice, the solution of the inversion is given by solving two linear systems, one shown in equation \ref{eq:linear_sys_p} and other in equation \ref{eq:linear_sys_q}. For this reason, we propose a nested algorithm for solving the inverse problem in two steps.           

Our iterative algorithm starts with an initial guess for the magnetization direction $\mathbf{q}_0$. At the $k$th iteration, we  calculated a set of magnetic moment $\mathbf{p}^k$ by imposing a positivity constraint on equation \ref{eq:linear_sys_p}. After estimating the magnetic-moment distribution $\mathbf{p}^k$ at the $k$th iteration using the previous estimate $\mathbf{q}^{k}$ for the magnetization direction, we estimate a new vector $\mathbf{q}^{k+1}$ by solving an unconstrained nonlinear inverse problem an applying the correction $\mathbf{\Delta q}^k$ using the equation \ref{eq:linear_sys_q}. The iterative process stops when the minimum of the goal function (equation \ref{eq:positivity_goal_function}a) is reached. An overview of the algorith is shown in figure \ref{fig:scheme_LM_NNLS} and in the algorithm \ref{cd: LM_NNLS}. 

\begin{algorithm}[H]
	%\DontPrintSemicolon
	%\SetAlgoLined
	\SetKwInOut{Input}{Input}
	\SetKwInOut{Output}{Output}
	\Input{$\mathbf{\Delta T}^o$, $\mathbf{q}_0$}
	\Output{$\mathbf{p}^\sharp$,$\mathbf{q}^\sharp$}
	
	\While{(not converge)  or ($i<i_{max}$) }
	{ \textbf{step 1}: Solve equation \ref{eq:linear_sys_p} using NNLS \;
	  \textbf{step 2}: Compute goal function (\ref{eq:positivity_goal_function}) \; 
	  \While{(not converge)  or ($j<j_{max}$) }
		{ \textbf{step 3}:  Initialize the Levenberg-Marquardt algorithm \;  
		  \textbf{step 4}: Compute goal function (\ref{eq:positivity_goal_function})\;
			\While{ $k<k_{marq}$ } {
				\textbf{step 5}:  Solve equation \ref{eq:linear_sys_q} \;
				\textbf{step 6}:  Apply the correction for magnetization direction \;
				\textbf{step 7}: Compute goal function (\ref{eq:positivity_goal_function})\;
			}
			\textbf{step 8}:  Analysis of convergence for inner loop.}
			\textbf{step 9}:  Analysis of convergence for outer loop.}
		
		\caption{Nested NNLS and Levenberg-Marquardt method}
		\label{cd: LM_NNLS}
	\end{algorithm}

\subsection{The choice of layer depth $\mathbf{z_c}$ and regularization parameter $\mathbf{\mu}$}

The procedure for the use of our methodology for estimating the total magnetization require the choice of two main parameters. The first one is the layer depth $z_c$ as shown in figure \ref{fig:eqlayer_figure} and the second is the regularization parameter $\mu$ shown in equation \ref{eq:linsys_p}.

The method of the choice of layer is based on a classical approach proposed by (CITAR DAMPNEY). The author pointed out that the layer depth should satisfy an interval from $2.5$ to $6$ times the grid spacing below the observation plane. It should be notice that the rule proposed by (CITAR DAMPNEY) was applied on an evenly spaced data. However, the choice for applying our method should correspond to an interval from $2$ to $3$ times to the greater grid spacing. It is necessarily to point out that this range of values was found empirically.

To solve the equation \ref{eq:linsys_p} we have to choose a reliable regularization parameter $\mu$. For this purpose, we use the L-curve method proposed by (CITAR HANSEN 1992). This approach is widely used in the literature to find a regularization parameter which filtering out enough noise whithout loosing to much information in the final solution. The procedure of finding the parameter is basically to plot a curve of optimal values between the solution norm and residual norm. The corner of the curve is the final result which gives a threshold between the regularization function and the data misfit.
