\append{Consequences of high-latitude estimation}
\label{append:high-latitute}

A limitation for estimating the magnetization direction using our method is its application to high-latitude anomalies. In this appendix, we prove the existence of high latitude difficulties providing a theoretical basis and testing it on extreme cases.

The process of estimating magnetization direction using equivalent-layer technique is divided into two inversions. One solves a constraining linear inversion using positivity and minimum-norm constraints on the magnetic-moment distribution and the second one comprises an unconstrained nonlinear inversion for estimating the magnetization direction. A way to extract infomation about the rank-deficiency and ill-conditioned linear systems is exploring the singular value decomposition. This procedure allows an $N \times M$ matrix can be rewritten as the product of three matrices, one of them formed by a set of singular values arranged in descending order. From linear algebra, if there is a row or a column of a matrix entirely formed by zeros then then it means that the linear equations are linearly dependent. Consequently, it leads to a rank-deficiency, ill-conditioned linear system and zero singular values. Here, the ill-posed system of linear equations is given in equation \ref{eq:linear_sys_q} for estimating the correction of the magnetization direction ($\bar{\mathbf{\Delta q}}^{k}$). This system is based on 2 variables (inclination and declination) where the $N \times 2$ sensitivity matrix $\mathbf{G}_{q}^{k}$ is explicitly given by

\begin{equation}
\mathbf{G}_{q}^{k} =
\left[ \begin{array}{cc}
\partial_{I} \mathbf{g}_{1}^{k^T} \bar{\mathbf{p}}^{k}   & \partial_{D} \mathbf{g}_{1}^{k^T} \bar{\mathbf{p}}^{k} \\
\vdots & \vdots  \\
\partial_{I} \mathbf{g}_{N}^{k^T} \bar{\mathbf{p}}^{k}   & \partial_{D} \mathbf{g}_{N}^{k^T} \bar{\mathbf{p}}^{k} 
\end{array} \right] ,
\label{eq:gp}
\end{equation}
in which $\bar{\mathbf{p}}^{k^T}$ is the estimated magnetic-moment distribution on the equivalent layer by solving the linear system given in equation \ref{eq:linear_sys_p} with positivity constraint and $\partial_{\alpha}\mathbf{g}_{i} (\mathbf{q}^k)$, where $\alpha= I, D$, a derivative of equation \ref{eq:f_i} with respect to inclination (first column) and the declination (second column) evaluated at the $i$th observation point, respectively. That is, by calculating the derivative of equation \ref{eq:f_i} in relation to magnetization direction is in fact the derivative of the equation \ref{eq:g_ij} in relation to each element of the vector $\hat{\mathbf{m}}(\mathbf{q})$ (equation \ref{eq:mag_vec}). That is, one element of the vector $\partial_{\alpha}\mathbf{g}_{i} (\mathbf{q}^k)$ is equal to 



\begin{equation}
\partial_{I} g_{ij} (\mathbf{q})  \equiv \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij}  \partial_{I} \hat{\mathbf{m}}(\mathbf{q}) =  \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij} 
	\left[ \begin{array}{c}
		-\sin I \cos D \\
		-\sin I \sin D\\
		 \cos I
	\end{array} \right], 
	\label{eq:mag_vec_inc}
\end{equation}
and 

\begin{equation}
	\partial_{D} g_{ij} (\mathbf{q})  \equiv \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij}  \partial_{D} \hat{\mathbf{m}}(\mathbf{q}) =  \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij} 
	\left[ \begin{array}{c}
		-\cos I \sin D \\
		 \cos I \cos D\\
		0
	\end{array} \right]. 
	\label{eq:mag_vec_dec}
\end{equation}

Hence, for the case whose magnetization direction of the true magnetic source has inclination $90^\circ$ and declination $0^\circ$, the equation \ref{eq:mag_vec_inc} and \ref{eq:mag_vec_dec} is, respectively, equal to 

 
\begin{equation}
\partial_{I} g_{ij} (\mathbf{q})  \equiv \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij}  \partial_{I} \hat{\mathbf{m}}(\mathbf{q}) =  \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij} 
	\left[ \begin{array}{c}
		-1 \\
		 0 \\
		 0
	\end{array} \right], 
	\label{eq:mag_vec_inc_90}
\end{equation}
and 

\begin{equation}
	\partial_{D} g_{ij} (\mathbf{q})  \equiv \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij}  \partial_{D} \hat{\mathbf{m}}(\mathbf{q}) =  \gamma_m \hat{\mathbf{F}}_0^T \mathbf{M}_{ij}
	\left[ \begin{array}{c}
		0 \\
		0 \\
		0
	\end{array} \right]. 
	\label{eq:mag_vec_dec_0}
\end{equation}
We can notice in this case that the second column of the sensitivity matrix in equation \ref{eq:gp} has all zero elements when the magnetization direction is vertical, leading to ill-posed inversion.

           



