\section{Application to synthetic data}
\label{sec:synt_tests}

We applied the proposed method to three synthetic data sets simulating different geological scenarios. The first one is generated by a model containing a set of multiple sources with different geometries, all of them with the same magnetization direction. The second data set is generated by a set of multiple magnetic bodies, but one them being a shallow-seated source with the same magnetization direction. In the third test, we violate the hypothesis of unidirectional magnetization by simulating a shallow-seated source with different magnetization direction from the other bodies.

In all tests, the simulated data were computed on a regular grid of $49 \times 25$ points (with a total of $N = 1225$ observations) at a constant height of $100$ m.  We assume an observation area extending $12$ km along the x- and y-axis, resulting a grid spacing of $250$ m and $500$ m on x- and y-axes, respectively. The data were contamined with pseudorandom Gaussian noise with zero mean and $10$ nT standard deviation. The geomagnetic field direction simulated was $I_0 = -40^\circ$ and $D_0 = -22^\circ$ for the inclination and declination, respectively. In the inversion, we use an equivalent layer composed by a grid of $49 \times 25$ dipoles (with a total of $M = 1225$ equivalent sources) positioned at a depth of $z_c = 1150$ m below the observation plane ($2.5$ times the greater grid spacing). We use the L-curve to choose the regularizing parameter ($\mu$). Our algorithm starts with an initial guess $\mathbf{q}_0 = (-10^\circ,-10^\circ)$ for inclination and declination, respectively.

\subsection{Unidirectional magnetization sources}
 
We generate a 3D prism with polygonal cross-section whose the top is positioned at a depth of $450$ m and the bottom $3150$ m with magnetization intensity of $4$ A/m. We also generate two spheres with magnetization intensity equal to $3$ A/m and radius equal to $500$ m. The coordinates of the spheres centers $x_c = 1800$ m, $y_c = -1800$ m and $z_c = 1000$ m and $x_c = 800$ m, $y_c = 800$ m and $z_c= 1000$ m. We produce two rectangular prisms with $2.5$ A/m of magnetization intensity. The smaller prism has the top at a depth of $450$ m and side lengths of $1000$ m, $700$ m and $500$ m along x-,y- and z-axes, respectively. The greater prism has the top at a depth of $500$ m and side lengths of $1000$ m, $2000$ m and $1550$ m along x-,y- and z-axes. All simulated sources have inclination $-25^\circ$ and declination $30^\circ$. The noise-corrupted data is shown in Figure \ref{fig:unidir_test}a. 

Figure \ref{fig:unidir_test}b shows the predicted data produced by equivalent layer. 
Figure \ref{fig:unidir_test}c shows the residuals defined as the difference between the simulated data (Figure \ref{fig:unidir_test}a) and the predicted data (Figure \ref{fig:unidir_test}b). The residuals appear normally distributed with a mean of $-0.30 \, nT$ and a standard deviation of $9.67 \, nT$ as shown in Figure \ref{fig:unidir_test}d. The estimated magnetization direction $\bar{\mathbf{q}}$ has inclination $-28.6^\circ$ and declination $30.8^\circ$ which are very close to the true one. Figure \ref{fig:unidir_test}e shows the estimated magnetic-moment distribution $\bar{\mathbf{p}}$. The convergence of the algorithm is shown in Figure \ref{fig:unidir_test}f. These results show that the all-positive magnetic-moment distribution and the estimated magnetization direction produce an acceptable data fitting.

\subsection{Unidirectional magnetization with shallow-seated source}

Here, we test the methodology perfomance when a shallow-seated source exists. The model seems the previous test except for the smaller prism, whose the top is $150$ m deep while maintaining its volume. The magnetization intensity of this shallow prism is equal to $1.5$ A/m. The magnetization direction of all sources is $-25^\circ$ inclination and declination $30^\circ$, respectively. The synthetic data is shown in Figure \ref{fig:unidir_shallow_test}a.

Figure \ref{fig:unidir_shallow_test}b shows the predicted total-field anomaly produced by equivalent layer. Figure \ref{fig:unidir_shallow_test}c shows the residuals defined as the difference between the simulated data (Figure \ref{fig:unidir_shallow_test}a) and the predicted data (Figure \ref{fig:unidir_shallow_test}b). The residuals appear normally distributed with a mean of $-0.42$ nT and a standard deviation of $10.67$ nT as shown in Figure \ref{fig:unidir_shallow_test}d. Figure \ref{fig:unidir_shallow_test}e shows the estimated magnetic-moment distribution $\bar{\mathbf{p}}$. The convergence of the algorithm is shown in Figure \ref{fig:unidir_shallow_test}f. Despite the large residual located above the shallow-seated source, we consider that the methodology produced a reliable result because the estimated magnetization direction $\bar{\mathbf{q}}$ has inclination $-28.7^\circ$ and declination $31.7^\circ$ and its very close to the corresponding true magnetization direction, and the all-positive magnetic-moment distribution produces an acceptable data fitting. 

\subsection{Shallow-seated source with different magnetization direction}

In this test, we simulate the presence of a shallow-seated body with different magnetization direction from the other magnetic sources. The shallow prism has the dimension and magnetization intensity equal to the previous test. However, the magnetization direction of the shallow prism is $20^\circ$ of inclination and $-30^\circ$ of declination, while the other sources has inclination $-25^\circ$ and declination $30^\circ$. The noise-corrupted data is shown in Figure \ref{fig:unidir_shallow_diff_test}a.

Figure \ref{fig:unidir_shallow_diff_test}b shows the predicted total-field anomaly. Figure \ref{fig:unidir_shallow_diff_test}c shows the residuals defined as the difference between the simulated data (Figure \ref{fig:unidir_shallow_diff_test}a) and the predicted data (Figure \ref{fig:unidir_shallow_diff_test}b). The residuals have a mean of $-0.71$ nT and a standard deviation of $10.67$ nT as shown in Figure \ref{fig:unidir_shallow_diff_test}d. The estimated magnetization direction $\bar{\mathbf{q}}$ has inclination $-30.4^\circ$ and declination $27.6^\circ$. Figure \ref{fig:unidir_shallow_diff_test}e shows the estimated magnetic-moment distribution $\bar{\mathbf{p}}$. The convergence of the algorithm is shown in Figure \ref{fig:unidir_shallow_diff_test}f. Despite the slight difference from the true magnetization direction, the estimated magnetic-moment distribution produces an acceptable data fit. With the exception of the small area exactly above the small-seated prism most of the residuals are closely $0$ nT.  

