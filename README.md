# Generalized positivity constraint on magnetic equivalent layers

by
Andre L. A. Reis,
Vanderlei C. Oliveira Jr.,
Valeria C. F. Barbosa

This paper has been submitted for publication in *Geophysics*.

> Reis, A.L.A, Oliveira Jr., V. C., & Barbosa, V. C. F., 2020. Generalized positivity constraint on magnetic equivalent layers, Geophysics, (Colocar DOI)
> (Colocar figura com resultados)

![](manuscript/figures/hawaii-trend.png)

*Caption for the example figure with the main results.*

## Abstract

It is known from potential theory that a continuous and planar layer of dipoles 
can exactly reproduce the total-field anomaly produced by arbitrary 3D sources. 
We prove the existence of an equivalent layer having an all-positive 
magnetic-moment distribution for the case in which the magnetization direction 
of this layer is the same as that of the true sources, regardless of whether the 
magnetization of the true sources is purely induced or not. 
By using this generalized positivity constraint, we present a new iterative method 
for estimating the total magnetization direction of 3D magnetic sources based on 
the equivalent-layer technique. Our method does not impose a priori information 
either about the shape or depth of the sources, does not require regularly spaced 
data, and presumes that the sources have a uniform magnetization direction. 
At each iteration, our method performs two steps. The first one solves a 
constrained linear inverse problem to estimate a positive magnetic-moment 
distribution over a discrete equivalent layer of dipoles. We consider that the 
equivalent sources are located on a plane and have an uniform and fixed 
magnetization direction. In the second step we use the estimated magnetic-moment 
distribution and solve a nonlinear inverse problem for estimating a new 
magnetization direction for the dipoles. The algorithm stops when the equivalent 
layer yields a total-field anomaly that fits the observed data. 
Tests with synthetic data simulating different geological scenarios show that 
the final estimated magnetization direction is close to the true one. 
We apply our method to a field data from the Goi{\' a}s Alkaline Province (GAP), 
over the Montes Claros complex, center of Brazil. The results suggest the presence 
of intrusions with remarkable remanent magnetization, in agreement with the current 
literature for this region.

> PAREI AQUI
## Software implementation

> Briefly describe the software that was written to produce the results of this
> paper.

All source code used to generate the results and figures in the paper are in
the `code` folder.
The calculations and figure generation are all run inside
[Jupyter notebooks](http://jupyter.org/).
The data used in this study is provided in `data` and the sources for the
manuscript text and figures are in `manuscript`.
Results generated by the code are saved in `results`.
See the `README.md` files in each directory for a full description.


## Getting the code

You can download a copy of all the files in this repository by cloning the
[git](https://git-scm.com/) repository:

    git clone https://github.com/pinga-lab/PAPER-REPO.git

or [download a zip archive](https://github.com/pinga-lab/PAPER-REPO/archive/master.zip).

A copy of the repository is also archived at *insert DOI here*


## Dependencies

You'll need a working Python environment to run the code.
The recommended way to set up your environment is through the
[Anaconda Python distribution](https://www.anaconda.com/download/) which
provides the `conda` package manager.
Anaconda can be installed in your user directory and does not interfere with
the system Python installation.
The required dependencies are specified in the file `environment.yml`.

We use `conda` virtual environments to manage the project dependencies in
isolation.
Thus, you can install our dependencies without causing conflicts with your
setup (even with different Python versions).

Run the following command in the repository folder (where `environment.yml`
is located) to create a separate environment and install all required
dependencies in it:

    conda env create


## Reproducing the results

Before running any code you must activate the conda environment:

    source activate ENVIRONMENT_NAME

or, if you're on Windows:

    activate ENVIRONMENT_NAME

This will enable the environment for your current terminal session.
Any subsequent commands will use software that is installed in the environment.

To build and test the software, produce all results and figures, and compile
the manuscript PDF, run this in the top level of the repository:

    make all

If all goes well, the manuscript PDF will be placed in `manuscript/output`.

You can also run individual steps in the process using the `Makefile`s from the
`code` and `manuscript` folders. See the respective `README.md` files for
instructions.

Another way of exploring the code results is to execute the Jupyter notebooks
individually.
To do this, you must first start the notebook server by going into the
repository top level and running:

    jupyter notebook

This will start the server and open your default web browser to the Jupyter
interface. In the page, go into the `code/notebooks` folder and select the
notebook that you wish to view/run.

The notebook is divided into cells (some have text while other have code).
Each cell can be executed using `Shift + Enter`.
Executing text cells does nothing and executing code cells runs the code
and produces it's output.
To execute the whole notebook, run all cells in order.


## License

All source code is made available under a BSD 3-clause license. You can freely
use and modify the code, without warranty, so long as you provide attribution
to the authors. See `LICENSE.md` for the full license text.

The manuscript text is not open source. The authors reserve the rights to the
article content, which is currently submitted for publication in the
JOURNAL NAME.
